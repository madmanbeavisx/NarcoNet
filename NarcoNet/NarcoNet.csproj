<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <TargetFramework>net472</TargetFramework>
        <LangVersion>latest</LangVersion>
        <Nullable>enable</Nullable>

        <!-- Enable deployment after build -->
        <DeployAfterBuild>true</DeployAfterBuild>
    </PropertyGroup>

    <!-- Debug configuration: Enable detailed logging -->
    <PropertyGroup Condition="'$(Configuration)' == 'Debug'">
        <DefineConstants>$(DefineConstants);DEBUG;TRACE;NARCONET_DEBUG_LOGGING</DefineConstants>
    </PropertyGroup>

    <ItemGroup>
        <PackageReference Include="Newtonsoft.Json" Version="13.0.4"/>
    </ItemGroup>

    <ItemGroup>
        <ProjectReference Include="..\NarcoNet.Utilities\NarcoNet.Utilities.csproj"/>
        <ProjectReference Include="..\NarcoNet.UI\NarcoNet.UI.csproj"/>
        <ProjectReference Include="..\NarcoNet.Updater\NarcoNet.Updater.csproj"/>
    </ItemGroup>

    <ItemGroup>
        <Reference Include="System.Net.Http"/>
        <Reference Include="Assembly-CSharp">
            <HintPath>..\References\Assembly-CSharp.dll</HintPath>
        </Reference>
        <Reference Include="BepInEx">
            <HintPath>..\References\BepInEx.dll</HintPath>
        </Reference>
        <Reference Include="BepInEx.Harmony">
            <HintPath>..\References\BepInEx.Harmony.dll</HintPath>
        </Reference>
        <Reference Include="bsg.console.core">
            <HintPath>..\References\bsg.console.core.dll</HintPath>
        </Reference>
        <Reference Include="Comfort">
            <HintPath>..\References\Comfort.dll</HintPath>
        </Reference>
        <Reference Include="Comfort.Unity">
            <HintPath>..\References\Comfort.Unity.dll</HintPath>
        </Reference>
        <Reference Include="Sirenix.Serialization">
            <HintPath>..\References\Sirenix.Serialization.dll</HintPath>
        </Reference>
        <Reference Include="spt-common">
            <HintPath>..\References\spt-common.dll</HintPath>
        </Reference>
        <Reference Include="spt-core">
            <HintPath>..\References\spt-core.dll</HintPath>
        </Reference>
        <Reference Include="spt-custom">
            <HintPath>..\References\spt-custom.dll</HintPath>
        </Reference>
        <Reference Include="spt-reflection">
            <HintPath>..\References\spt-reflection.dll</HintPath>
        </Reference>
        <Reference Include="Unity.TextMeshPro">
            <HintPath>..\References\Unity.TextMeshPro.dll</HintPath>
        </Reference>
        <Reference Include="UnityEngine">
            <HintPath>..\References\UnityEngine.dll</HintPath>
        </Reference>
        <Reference Include="UnityEngine.AssetBundleModule">
            <HintPath>..\References\UnityEngine.AssetBundleModule.dll</HintPath>
        </Reference>
        <Reference Include="UnityEngine.ClothModule">
            <HintPath>..\References\UnityEngine.ClothModule.dll</HintPath>
        </Reference>
        <Reference Include="UnityEngine.CoreModule">
            <HintPath>..\References\UnityEngine.CoreModule.dll</HintPath>
        </Reference>
        <Reference Include="UnityEngine.IMGUIModule">
            <HintPath>..\References\UnityEngine.IMGUIModule.dll</HintPath>
        </Reference>
        <Reference Include="UnityEngine.InputLegacyModule">
            <HintPath>..\References\UnityEngine.InputLegacyModule.dll</HintPath>
        </Reference>
        <Reference Include="UnityEngine.TextRenderingModule">
            <HintPath>..\References\UnityEngine.TextRenderingModule.dll</HintPath>
        </Reference>
        <Reference Include="UnityEngine.UI">
            <HintPath>..\References\UnityEngine.UI.dll</HintPath>
        </Reference>
    </ItemGroup>

    <Target Name="PostBuild" AfterTargets="PostBuildEvent">
        <PropertyGroup>
            <BuildOutputDir>$(MSBuildProjectDirectory)\..\Build\BepInEx\plugins\MadManBeavis-NarcoNet</BuildOutputDir>
        </PropertyGroup>

        <!-- Create output directory structure -->
        <MakeDir Directories="$(BuildOutputDir)"/>

        <!-- Copy only the main NarcoNet.dll (not dependencies) -->
        <Copy SourceFiles="$(TargetPath)" DestinationFolder="$(BuildOutputDir)"/>

        <!-- Copy NarcoNet.UI.dll and NarcoNet.Utilities.dll as they are project dependencies -->
        <Copy SourceFiles="$(OutDir)NarcoNet.UI.dll" DestinationFolder="$(BuildOutputDir)" Condition="Exists('$(OutDir)NarcoNet.UI.dll')"/>
        <Copy SourceFiles="$(OutDir)NarcoNet.Utilities.dll" DestinationFolder="$(BuildOutputDir)" Condition="Exists('$(OutDir)NarcoNet.Utilities.dll')"/>

        <Message Text="Build output copied to: $(BuildOutputDir)" Importance="high"/>
    </Target>

</Project>
